<script>
  const symbols = ["ðŸ•","ðŸŒˆ","ðŸ","â­","ðŸŽ§","ðŸ©","ðŸŒµ","ðŸ¢"]; // 8 pairs = 16 cards
  const board = document.getElementById("board");
  const movesEl = document.getElementById("moves");
  const timeEl = document.getElementById("time");
  const messageEl = document.getElementById("message");
  const resetBtn = document.getElementById("reset");

  let firstCard = null;
  let secondCard = null;
  let lockBoard = false;
  let moves = 0;
  let matchedPairs = 0;
  let timer = null;
  let seconds = 0;
  let gameStarted = false;

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function startTimer() {
    if (gameStarted) return;
    gameStarted = true;
    timer = setInterval(() => {
      seconds++;
      timeEl.textContent = seconds + "s";
    }, 1000);
  }

  function stopTimer() {
    clearInterval(timer);
    timer = null;
  }

  function resetTimer() {
    stopTimer();
    seconds = 0;
    gameStarted = false;
    timeEl.textContent = "0s";
  }

  function createCardElement(symbol) {
    const card = document.createElement("div");
    card.classList.add("card");
    card.dataset.symbol = symbol;

    const inner = document.createElement("div");
    inner.classList.add("card-inner");

    const front = document.createElement("div");
    front.classList.add("card-face", "card-front");
    front.textContent = "?";

    const back = document.createElement("div");
    back.classList.add("card-face", "card-back");
    back.textContent = symbol;

    inner.appendChild(front);
    inner.appendChild(back);
    card.appendChild(inner);

    card.addEventListener("click", () => handleCardClick(card));

    return card;
  }

  function setupBoard() {
    board.innerHTML = "";
    const deck = shuffle([...symbols, ...symbols]); // duplicate + shuffle
    deck.forEach(sym => {
      const cardEl = createCardElement(sym);
      board.appendChild(cardEl);
    });
  }

  function resetGame() {
    firstCard = null;
    secondCard = null;
    lockBoard = false;
    moves = 0;
    matchedPairs = 0;
    movesEl.textContent = "0";
    messageEl.textContent = "";
    resetTimer();
    setupBoard();
  }

  function handleCardClick(card) {
    if (lockBoard) return;
    if (card === firstCard) return;
    if (card.classList.contains("matched")) return;

    startTimer();

    card.classList.add("flipped");

    if (!firstCard) {
      firstCard = card;
      return;
    }

    secondCard = card;
    lockBoard = true;
    moves++;
    movesEl.textContent = moves;

    checkForMatch();
  }

  function checkForMatch() {
    const isMatch = firstCard.dataset.symbol === secondCard.dataset.symbol;

    if (isMatch) {
      firstCard.classList.add("matched");
      secondCard.classList.add("matched");
      matchedPairs++;

      resetSelection();

      if (matchedPairs === symbols.length) {
        handleWin();
      }
    } else {
      setTimeout(() => {
        firstCard.classList.remove("flipped");
        secondCard.classList.remove("flipped");
        resetSelection();
      }, 800);
    }
  }

  function resetSelection() {
    [firstCard, secondCard] = [null, null];
    lockBoard = false;
  }

  function handleWin() {
    stopTimer();
    messageEl.classList.add("win");
    messageEl.textContent = `Nice work! You won in ${moves} moves and ${seconds}s.`;
  }

  resetBtn.addEventListener("click", resetGame);

  // Start first game
  resetGame();
</script>
